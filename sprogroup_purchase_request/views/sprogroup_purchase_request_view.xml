<?xml version="1.0"?>
<!-- Copyright 2016 Eficent Business and IT Consulting Services S.L.
     License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl-3.0) -->
<odoo>
    <record model="ir.ui.view" id="view_sprogroup_purchase_request_form">
        <field name="name">sprogroup.purchase.request.form</field>
        <field name="model">sprogroup.purchase.request</field>
        <field name="arch" type="xml">
            <form string="Purchase Request" version="7.0">
                <header>
                    <button name="button_draft"
                            states="to_approve,leader_approved,manager_approved,rejected,done"
                            string="Reset"
                            type="object"
                            groups="sprogroup_purchase_request.group_sprogroup_purchase_request_manager"/>
                    <button name="button_to_approve" states="draft"
                            string="Request approval" type="object"
                            class="oe_highlight"/>
                    <button name="button_leader_approved"
                            string="HOD Approve"
                            type="object"
                            class="oe_highlight"
                            groups="base.group_user"
                            attrs="{'invisible': [('can_leader_approved', '=', False)]}"/>
                    <button name="button_manager_approved"
                            states="leader_approved"
                            string="Procurement Approve"
                            type="object"
                            class="oe_highlight"
                            groups="purchase.group_purchase_manager"
                    />
                    <button name="button_done"
                            states="manager_approved"
                            string="Done"
                            type="object"
                            class="oe_highlight"
                            groups="sprogroup_purchase_request.group_sprogroup_purchase_request_manager"/>
                    <button name="button_rejected"
                            string="Reject"
                            type="object"
                            attrs="{'invisible': [('can_reject', '=', False)]}"
                    />

                    <button string="New Quotation" states="done" name="make_purchase_quotation" type="object"
                            groups="sprogroup_purchase_request.group_sprogroup_purchase_request_manager"
                    />

                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,to_approve,leader_approved,manager_approved,done,rejected"
                           statusbar_colors='{"manager_approved":"blue"}'/>


                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object"
                                name="action_open_purchase"
                                class="oe_stat_button"
                                icon="fa-shopping-cart" attrs="{'invisible':[('po_count', '=', 0)]}">
                            <field name="po_count" widget="statinfo" string="Purchase"/>
                        </button>
                    </div>
                    <field name="is_editable" invisible="1"/>
                    <div class="oe_edit_only">
                        <label for="name" class="oe_inline"/>
                    </div>
                    <h1>
                        <field name="name" class="oe_inline" attrs="{'readonly': [('is_editable','=', False)]}"/>
                        <!-- <label for="space" name="Space" string="-"/> -->
                        <field name="code" readonly="1"/>
                    </h1>
                    <group>
                        <group>
                            <field name="can_leader_approved" invisible="1"/>
                            <field name="can_manager_approved" invisible="1"/>
                            <field name="can_reject" invisible="1"/>
                            <field name="requested_by" readonly="1"/>
                            <!-- <field name="department_id" /> -->
                            <field name="assigned_to" domain="[('id','!=',uid)]"
                                   attrs="{'readonly': [('is_editable','=', False)]}"/>
                            <field name="trip_no" attrs="{'readonly': [('is_editable','=', False)]}"
                                   groups="sprogroup_purchase_request.group_trip_expense"/>
                        </group>
                        <group>
                            <field name="date_start"
                                   attrs="{'readonly': [('is_editable','=', False)]}"/>
                            <field name="end_start"
                                   attrs="{'readonly': [('is_editable','=', False)]}"/>
                            <field name="reason"
                                   attrs="{'readonly': [('is_editable','=', False)],'invisible': [('state','!=','rejected')]}"/>
                            <field name="rejected_date"
                                   attrs="{'readonly': [('is_editable','=', False)],'invisible': [('state','!=','rejected')]}"/>
                            <field name="hod_approval_date" invisible="1"/>
                            <field name="procure_approval_date" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Products">
                            <field name="line_ids" attrs="{'readonly': [('is_editable','=', False)]}">
                                <tree decoration-muted="cancelled == True">
                                    <field name="product_id"
                                           options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}"/>
                                    <field name="name"/>

                                    <field name="product_qty"/>
                                    <field name="price_unit"/>
                                    <field name="product_uom_id" groups="uom.group_uom"/>
                                    <field name="date_required"/>
                                    <field name="cancelled" invisible="1"/>
                                    <field name="is_editable" invisible="1"/>
                                </tree>
                                <form>
                                    <sheet>
                                        <group>
                                            <group>
                                                <field name="is_editable" invisible="1"/>
                                                <field name="product_id"
                                                       options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}"/>
                                                <field name="name"/>
                                                <label for="product_qty"/>
                                                <div>
                                                    <field name="product_qty"
                                                           class="oe_inline"/>
                                                    <field name="product_uom_id"
                                                           groups="uom.group_uom"
                                                           class="oe_inline"/>
                                                </div>
                                                <field name="price_unit"/>

                                                <field name="date_required"/>
                                                <field name="cancelled"/>
                                            </group>
                                        </group>
                                        <group>
                                            <separator string="Specifications"/>
                                            <newline/>
                                            <field name="specifications" nolabel="1"
                                                   attrs="{'readonly': [('is_editable','=', False)]}"/>
                                        </group>
                                        <notebook>
                                        </notebook>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        <page string="Description" invisible="1">
                            <field name="description" attrs="{'readonly': [('is_editable','=', False)]}"/>
                        </page>

                        <page string="Other Information" invisible="1">
                            <group>
                                <group>
                                    <field name="create_date" readonly="1"/>
                                </group>
                                <group>
                                    <field name="create_uid" readonly="1"/>
                                </group>
                            </group>

                        </page>
                    </notebook>
                    <!--                        <field name="rejected_note" placeholder="Reason for rejection"/>-->
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="view_sprogroup_purchase_request_tree">
        <field name="name">sprogroup.purchase.request.tree</field>
        <field name="model">sprogroup.purchase.request</field>
        <field name="arch" type="xml">
            <tree decoration-bf="message_needaction==True"
                  decoration-info="state in ('draft','to_approve')"
                  decoration-muted="state in ('rejected')"
                  string="Purchase Request">
                <field name="message_needaction" invisible="1"/>
                <field name="name"/>
                <field name="code"/>
                <field name="date_start"/>
                <field name="requested_by"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_sprogroup_purchase_request_search" model="ir.ui.view">
        <field name="name">sprogroup.purchase.request.list.select</field>
        <field name="model">sprogroup.purchase.request</field>
        <field name="arch" type="xml">
            <search string="Search Purchase Request">
                <field name="name" string="Purchase Request"/>
                <separator/>
                <field name="state"/>
                <field name="assigned_to" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}"/>
                <field name="requested_by"/>
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
                <filter name="unassigned" string="Unassigned"
                        domain="[('assigned_to','=', False)]"
                        help="Unassigned Request"/>
                <filter name="state_draft" string="Draft"
                        domain="[('state','=','draft')]"
                        help="Request is to be approved"/>
                <filter name="state_to_approve" string="To Approve"
                        domain="[('state','=','to_approve')]"
                        help="Request is to be approved"/>
                <filter name="state_approved" string="HOD Approved"
                        domain="[('state','=','leader_approved')]"
                        help="Request is approved by leader"/>
                <filter name="state_approved" string="Procurement Approved"
                        domain="[('state','=','manager_approved')]"
                        help="Request is approved"/>
                <filter name="state_rejected" string="Rejected"
                        domain="[('state','=','rejected')]"
                        help="Request is rejected"/>
                <filter name="state_done" string="Done"
                        domain="[('state','=','done')]"
                        help="Request is done"/>
                <filter string="Unread Messages"
                        name="message_needaction"
                        domain="[('message_needaction','=',True)]"/>
                <filter string="Assigned to me"
                        name="assigned_to_me"
                        domain="[('assigned_to','=',uid)]"/>
                <filter domain="[('requested_by','=', uid)]" name="my_request"
                        help="My requests"/>
                <group expand="0" string="Group By...">
                    <filter string="Requested by" icon="terp-personal" name="request_by"
                            domain="[]"
                            context="{'group_by':'requested_by'}"/>
                    <filter string="Assigned to" icon="terp-personal" name="assigned_by"
                            domain="[]"
                            context="{'group_by':'assigned_to'}"/>
                    <filter string="Creation Date" name="start_date" icon="terp-go-month" domain="[]"
                            context="{'group_by':'date_start'}"/>
                    <filter string="Rejected Date" name="reject_date" icon="terp-go-month" domain="[]"
                            context="{'group_by':'rejected_date'}"/>
                    <filter string="HOD Approval" name="hodapprove_date" icon="terp-go-month" domain="[]"
                            context="{'group_by':'hod_approval_date'}"/>
                    <filter string="Procurement Approval" name="proapprove_date" icon="terp-go-month" domain="[]"
                            context="{'group_by':'procure_approval_date'}"/>
                    <filter string="Trip Number" name="trip_no" icon="terp-go-month" domain="[]"
                            context="{'group_by':'trip_no'}" groups="sprogroup_purchase_request.group_trip_expense"/>
                </group>
            </search>
        </field>
    </record>


    <record model="ir.actions.act_window" id="sprogroup_purchase_request_form_action">
        <field name="name">Purchase Requests</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sprogroup.purchase.request</field>
        <!-- <field name="view_type">form</field> -->
        <field name="view_mode">tree,form</field>
        <field name="context">{"search_default_requested_by":uid}</field>
        <field name="search_view_id" ref="view_sprogroup_purchase_request_search"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Click to start a new purchase request process.
            </p>
            <p>
                A purchase request is an instruction to Purchasing to procure
                a certain quantity of materials services, so that they are
                available at a certain point in time.
            </p>
        </field>
    </record>

    <!-- <menuitem
        id="menu_sprogroup_purchase_request_act"
        sequence="10"
        parent="purchase.menu_procurement_management"
        action="sprogroup_purchase_request_form_action"
        /> -->

    <!-- <menuitem
    id="menu_base_attendance_root"
    name="Partner Attendances"
    sequence="90"
    groups="group_res_attendance"
    web_icon="base_attendance,static/description/icon.png"
/>
<menuitem
    id="menu_hr_attendance_manage_attendances"
    name="Manage Attendances"
    parent="menu_base_attendance_root"
    sequence="20"
    groups="base_attendance.group_res_attendance"
/>       -->

    <menuitem
            id="root_menu_sprogroup_purchase_request"
            name="Purchase Requests"
            web_icon="sprogroup_purchase_request,static/description/icon.png"
            groups="group_sprogroup_purchase_request_manager,group_sprogroup_purchase_request_user"/>

    <menuitem
            id="menu_sprogroup_purchase_request_act_new"
            name="Purchase Requests"
            parent="root_menu_sprogroup_purchase_request"
            action="sprogroup_purchase_request_form_action"
            groups="group_sprogroup_purchase_request_manager,group_sprogroup_purchase_request_user"/>


    <act_window
            context="{'search_default_product_id': [active_id], 'default_product_id': active_id}"
            id="action_sprogroup_purchase_request_line_product_tree"
            name="Sprogroup Purchase Requests"
            res_model="sprogroup.purchase.request.line"
            binding_model="product.product"
            groups="base.group_user"/>

    <record id="backorder_inherit" model="ir.ui.view">
        <field name="name">backorder.form.inherit</field>
        <field name="model">stock.backorder.confirmation</field>
        <field name="inherit_id" ref="stock.view_backorder_confirmation"/>
        <field name="arch" type="xml">
            <xpath expr="//group" position="after">
                <div class="oe_edit_only">
                    <label for="reason" class="oe_inline"/>
                    <field name="reason"/>
                </div>
            </xpath>
        </field>
    </record>

    <record id="picking_form_inherit" model="ir.ui.view">
        <field name="name">picking.form.inherit</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='backorder_id']" position="after">
                <field name="back_reason" attrs="{'invisible': [('back_reason','=', False)]}"/>
            </xpath>
            <xpath expr="//notebook/page[@name='note']" position="after">
                <page string="Return Remarks" name="return_remarks">
                    <label for="return_remark" class="oe_inline"/>
                    <field name="return_remark"/>
                </page>
            </xpath>
        </field>
    </record>
    <record id="purchase_order_form_inherit_mict_new" model="ir.ui.view">
        <field name="name">purchase.order.form.inherit.mict</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="arch" type="xml">
            <data>
                <xpath expr="//field[@name='order_line']/tree/field[@name='product_qty']" position="after">
                    <field name="sprogroup_purchase_request_line_id" string="Request Line" invisible="1"/>
                </xpath>
                <field name="origin" position="replace">
                    <field name="origin" attrs="{'invisible': [('origin','=',False)]}" readonly="1" force_save="1"/>
                </field>
                <field name="partner_ref" position="after">
                    <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
                </field>
            </data>
        </field>
    </record>
    <record id="view_move_form_inherit_mict_pr" model="ir.ui.view">
        <field name="name">account.move.view.form.inherit.mict_pr</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <field name="partner_bank_id" position="after">
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
            </field>
            <!--            jawaid 20/4/2022-->
            <!--            <field name="vehicle_id" position="attributes">-->
            <!--                <attribute name="string">Fleet and Equipment</attribute>-->
            <!--            </field>-->
            <!--            jawaid 20/4/2022-->
        </field>
    </record>
    <record id="view_account_payment_form_inherit_mict_pr" model="ir.ui.view">
        <field name="name">account.payment.form.inherit.mict.pr</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <field name="ref" position="after">
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
            </field>
        </field>
    </record>
    <record id="view_purchase_order_filter_inherit_mict_pr" model="ir.ui.view">
        <field name="name">purchase.order.search.inherit.mict.pr</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
        <field name="arch" type="xml">
            <field name="product_id" position="after">
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
            </field>
            <filter name="order_date" position="after">
                <filter string="Trip Number" name="trip_no" domain="[]" context="{'group_by': 'trip_no'}"
                        groups="sprogroup_purchase_request.group_trip_expense"/>
            </filter>
        </field>
    </record>
    <record id="view_account_move_filter_inherit_mict_pr" model="ir.ui.view">
        <field name="name">account.move.search.inherit.mict.pr</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_account_invoice_filter"/>
        <field name="arch" type="xml">
            <field name="journal_id" position="after">
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
            </field>
            <filter name="duedate" position="after">
                <filter string="Trip Number" name="trip_no" domain="[]" context="{'group_by': 'trip_no'}"
                        groups="sprogroup_purchase_request.group_trip_expense"/>
            </filter>
        </field>
    </record>
    <record id="view_account_payment_search_inherit_mict_pr" model="ir.ui.view">
        <field name="name">account.payment.search.inherit.mict.pr</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_search"/>
        <field name="arch" type="xml">
            <field name="journal_id" position="after">
                <field name="trip_no" groups="sprogroup_purchase_request.group_trip_expense"/>
            </field>
            <filter name="company" position="after">
                <filter string="Trip Number" name="trip_no" domain="[]" context="{'group_by': 'trip_no'}"
                        groups="sprogroup_purchase_request.group_trip_expense"/>
            </filter>
        </field>
    </record>
    <template id="assets_backend" name="web_hide_create assets" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/sprogroup_purchase_request/static/src/js/hide_create_button.js"/>
        </xpath>
    </template>
    <record id="group_hide_create_btn" model="res.groups">
        <field name="name">Hide Create Button(PO)</field>
    </record>
</odoo>
